<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Everyday Ham - YouTube Monetization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #152333;
            color: #fdf8e5;
            padding: 2vh 2vw;
            overflow: hidden;
        }

        /* CSS Variables for Brand Colors */
        :root {
            --background-dark: #152333;
            --background-medium: #313e4f;
            --orange-primary: #ff7030;
            --cream-text: #fdf8e5;
            --orange-light: rgba(255, 112, 48, 0.1);
            --border-color: rgba(21, 35, 51, 0.5);
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 2vh;
            padding-bottom: 1.5vh;
            border-bottom: 2px solid var(--border-color);
        }

        .header h1 {
            font-size: 2.5vh;
            color: var(--orange-primary);
            font-weight: 700;
            margin-bottom: 0.5vh;
            text-transform: uppercase;
            letter-spacing: 0.1vw;
        }

        .header .subtitle {
            font-size: 1.4vh;
            color: var(--cream-text);
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.15vw;
        }

        .last-updated {
            font-size: 1.1vh;
            color: var(--cream-text);
            opacity: 0.5;
            margin-top: 0.5vh;
        }

        /* Grid Layouts */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5vw;
            margin-bottom: 2vh;
        }

        .two-column-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5vw;
            margin-bottom: 2vh;
        }

        /* Stat Container */
        .stat-container {
            background: rgba(49, 62, 79, 0.3);
            border: 2px solid var(--border-color);
            border-radius: 1vh;
            padding: 1.5vh 1.5vw;
            text-align: center;
        }

        .stat-label {
            font-size: 1.2vh;
            color: var(--cream-text);
            opacity: 0.6;
            text-transform: uppercase;
            letter-spacing: 0.1vw;
            margin-bottom: 0.8vh;
            font-weight: 600;
        }

        .stat-value {
            font-size: 3.5vh;
            color: var(--cream-text);
            font-weight: 700;
            margin-bottom: 0.5vh;
        }

        .stat-change {
            font-size: 1.3vh;
            font-weight: 600;
        }

        .stat-change.positive {
            color: #4ade80;
        }

        .stat-change.negative {
            color: #f87171;
        }

        .stat-change.neutral {
            color: var(--cream-text);
            opacity: 0.5;
        }

        /* Chart Container */
        .chart-container {
            background: rgba(49, 62, 79, 0.3);
            border: 2px solid var(--border-color);
            border-radius: 1vh;
            padding: 1.5vh 1.5vw;
            margin-bottom: 2vh;
        }

        .chart-title {
            font-size: 1.5vh;
            color: var(--orange-primary);
            text-transform: uppercase;
            letter-spacing: 0.1vw;
            margin-bottom: 1.5vh;
            font-weight: 700;
            text-align: center;
        }

        #revenueChart {
            height: 25vh !important;
        }

        /* Two Column Sections */
        .section-title {
            font-size: 1.4vh;
            color: var(--orange-primary);
            text-transform: uppercase;
            letter-spacing: 0.1vw;
            margin-bottom: 1vh;
            font-weight: 700;
        }

        /* Ad Type Breakdown */
        .ad-type-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8vh 0;
            border-bottom: 1px solid var(--border-color);
        }

        .ad-type-item:last-child {
            border-bottom: none;
        }

        .ad-type-name {
            font-size: 1.3vh;
            color: var(--cream-text);
            font-weight: 500;
        }

        .ad-type-stats {
            display: flex;
            align-items: center;
            gap: 1vw;
        }

        .ad-type-percentage {
            font-size: 1.4vh;
            color: var(--orange-primary);
            font-weight: 700;
            min-width: 3vw;
            text-align: right;
        }

        .ad-type-revenue {
            font-size: 1.2vh;
            color: var(--cream-text);
            opacity: 0.6;
            min-width: 4vw;
            text-align: right;
        }

        /* Top Videos */
        .video-item {
            padding: 1vh 0;
            border-bottom: 1px solid var(--border-color);
        }

        .video-item:last-child {
            border-bottom: none;
        }

        .video-title {
            font-size: 1.3vh;
            color: var(--cream-text);
            font-weight: 600;
            margin-bottom: 0.5vh;
            line-height: 1.4;
        }

        .video-stats {
            display: flex;
            gap: 2vw;
            font-size: 1.2vh;
        }

        .video-revenue {
            color: var(--orange-primary);
            font-weight: 700;
        }

        .video-views {
            color: var(--cream-text);
            opacity: 0.6;
        }

        /* Projection Box */
        .projection-box {
            background: var(--orange-light);
            border: 2px solid var(--orange-primary);
            border-radius: 1vh;
            padding: 1.5vh 1.5vw;
            text-align: center;
        }

        .projection-label {
            font-size: 1.2vh;
            color: var(--cream-text);
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.1vw;
            margin-bottom: 0.8vh;
        }

        .projection-value {
            font-size: 3vh;
            color: var(--orange-primary);
            font-weight: 700;
        }

        .projection-note {
            font-size: 1vh;
            color: var(--cream-text);
            opacity: 0.5;
            margin-top: 0.5vh;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 2vh;
            color: var(--cream-text);
            opacity: 0.5;
            font-size: 1.2vh;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 4vh;
            font-size: 1.5vh;
            color: var(--cream-text);
            opacity: 0.6;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>üê∑ The Everyday Ham Podcast</h1>
        <div class="subtitle">YouTube Monetization Dashboard</div>
        <div class="last-updated" id="lastUpdated">Loading...</div>
    </div>

    <!-- Main Metrics Grid -->
    <div class="metrics-grid">
        <div class="stat-container">
            <div class="stat-label">Total Revenue</div>
            <div class="stat-value" id="totalRevenue">$0.00</div>
            <div class="stat-change neutral" id="revenueChange">--</div>
        </div>
        <div class="stat-container">
            <div class="stat-label">RPM</div>
            <div class="stat-value" id="rpm">$0.00</div>
            <div class="stat-change neutral" id="rpmChange">--</div>
        </div>
        <div class="stat-container">
            <div class="stat-label">CPM</div>
            <div class="stat-value" id="cpm">$0.00</div>
            <div class="stat-change neutral" id="cpmChange">--</div>
        </div>
        <div class="stat-container">
            <div class="stat-label">Monetized Plays</div>
            <div class="stat-value" id="monetizedPlaybacks">0</div>
            <div class="stat-change neutral" id="playbacksChange">--</div>
        </div>
    </div>

    <!-- Revenue Trend Chart -->
    <div class="chart-container">
        <div class="chart-title">30-Day Revenue Trend</div>
        <canvas id="revenueChart"></canvas>
    </div>

    <!-- Two Column Grid: Ad Types & Top Videos -->
    <div class="two-column-grid">
        <!-- Ad Type Breakdown -->
        <div class="stat-container">
            <div class="section-title">Revenue by Ad Type</div>
            <div id="adTypeList">
                <div class="loading">Loading ad data...</div>
            </div>
        </div>

        <!-- Top Earning Videos -->
        <div class="stat-container">
            <div class="section-title">Top Earning Videos</div>
            <div id="topVideosList">
                <div class="loading">Loading videos...</div>
            </div>
        </div>
    </div>

    <!-- Projected Monthly Revenue -->
    <div class="projection-box">
        <div class="projection-label">Projected Monthly Revenue</div>
        <div class="projection-value" id="projectedRevenue">$0.00</div>
        <div class="projection-note">Based on current 30-day pace</div>
    </div>

    <script>
        // Configuration
        const DATA_URL = 'https://raw.githubusercontent.com/jmills06/youtube-analytics-data/main/youtube_monetization.json';
        const REFRESH_INTERVAL = 300000; // 5 minutes
        
        let revenueChart = null;

        // Utility Functions
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }

        function formatNumber(value) {
            return new Intl.NumberFormat('en-US').format(value);
        }

        function formatChange(value) {
            if (value === 0 || value === null || value === undefined) {
                return { text: '--', className: 'neutral' };
            }
            const sign = value > 0 ? '+' : '';
            const className = value > 0 ? 'positive' : value < 0 ? 'negative' : 'neutral';
            return { text: `${sign}${value.toFixed(1)}%`, className };
        }

        // Update Dashboard
        async function fetchData() {
            try {
                const response = await fetch(DATA_URL + '?t=' + new Date().getTime());
                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }
                const data = await response.json();
                updateDashboard(data);
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('lastUpdated').textContent = 'Error loading data';
            }
        }

        function updateDashboard(data) {
            // Update last updated timestamp
            document.getElementById('lastUpdated').textContent = 
                `Last Updated: ${data.last_updated || 'Unknown'}`;

            // Update main metrics
            document.getElementById('totalRevenue').textContent = formatCurrency(data.total_revenue || 0);
            document.getElementById('rpm').textContent = formatCurrency(data.rpm || 0);
            document.getElementById('cpm').textContent = formatCurrency(data.cpm || 0);
            document.getElementById('monetizedPlaybacks').textContent = formatNumber(data.monetized_playbacks || 0);

            // Update changes
            updateChange('revenueChange', data.revenue_change);
            updateChange('rpmChange', data.rpm_change);
            updateChange('cpmChange', data.cpm_change);
            updateChange('playbacksChange', data.playbacks_change);

            // Update projected revenue
            document.getElementById('projectedRevenue').textContent = 
                formatCurrency(data.projected_monthly_revenue || 0);

            // Update revenue chart
            updateRevenueChart(data.revenue_chart);

            // Update ad type breakdown
            updateAdTypeBreakdown(data.ad_type_breakdown);

            // Update top videos
            updateTopVideos(data.top_earning_videos);
        }

        function updateChange(elementId, value) {
            const element = document.getElementById(elementId);
            const change = formatChange(value);
            element.textContent = change.text;
            element.className = 'stat-change ' + change.className;
        }

        function updateRevenueChart(chartData) {
            if (!chartData || !chartData.labels || chartData.labels.length === 0) {
                return;
            }

            const ctx = document.getElementById('revenueChart').getContext('2d');

            if (revenueChart) {
                revenueChart.destroy();
            }

            revenueChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: 'Revenue',
                        data: chartData.values,
                        borderColor: '#ff7030',
                        backgroundColor: 'rgba(255, 112, 48, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 4,
                        pointBackgroundColor: '#ff7030',
                        pointBorderColor: '#fdf8e5',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(49, 62, 79, 0.95)',
                            titleColor: '#fdf8e5',
                            bodyColor: '#fdf8e5',
                            borderColor: '#ff7030',
                            borderWidth: 1,
                            padding: 10,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return 'Revenue: ' + formatCurrency(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(253, 248, 229, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#fdf8e5',
                                font: {
                                    size: 10
                                },
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#fdf8e5',
                                font: {
                                    size: 10
                                },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        function updateAdTypeBreakdown(adTypeData) {
            const container = document.getElementById('adTypeList');
            
            if (!adTypeData || Object.keys(adTypeData).length === 0) {
                container.innerHTML = '<div class="empty-state">No ad type data available</div>';
                return;
            }

            // Sort by percentage descending
            const sortedAdTypes = Object.entries(adTypeData)
                .sort((a, b) => b[1].percentage - a[1].percentage);

            let html = '';
            sortedAdTypes.forEach(([adType, stats]) => {
                html += `
                    <div class="ad-type-item">
                        <div class="ad-type-name">${adType}</div>
                        <div class="ad-type-stats">
                            <div class="ad-type-percentage">${stats.percentage.toFixed(1)}%</div>
                            <div class="ad-type-revenue">${formatCurrency(stats.revenue)}</div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function updateTopVideos(videos) {
            const container = document.getElementById('topVideosList');
            
            if (!videos || videos.length === 0) {
                container.innerHTML = '<div class="empty-state">No video data available</div>';
                return;
            }

            let html = '';
            videos.slice(0, 5).forEach(video => {
                html += `
                    <div class="video-item">
                        <div class="video-title">${video.title}</div>
                        <div class="video-stats">
                            <div class="video-revenue">${formatCurrency(video.revenue)}</div>
                            <div class="video-views">${formatNumber(video.views)} views</div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Initialize
        fetchData();
        setInterval(fetchData, REFRESH_INTERVAL);
    </script>
</body>
</html>
